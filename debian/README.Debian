hiphop-php for Debian
---------------------

This is the start of the packaging

test with :
dpkg-buildpackage   -b


 -- James Michael DuPont <JamesMikeDuPont@googlemail.com>  Sat, 20 Feb 2010 11:27:49 +0100


#1 First Bug :
cd /media/sdd2/home/mdupont/2010/02/hiphop/hiphop-php-0.1/builddir/src && /media/NewFoundSpace/usr/local/bin/c++   -D_GNU_SOURCE -D_REENTRANT=1 -D_PTHREADS=1 -fPIC -fno-omit-frame-pointer -ftemplate-depth-60 -Wall -Woverloaded-virtual -Wno-deprecated -Wno-parentheses -Wno-strict-aliasing -Wno-write-strings  -I/usr/local/include -I/usr/include/mysql -I/usr/include/libxml2 -I/media/sdd2/home/mdupont/2010/02/hiphop/hiphop-php-0.1/src/third_party/libsqlite3 -I/media/sdd2/home/mdupont/2010/02/hiphop/hiphop-php-0.1/src/third_party/timelib -I/media/sdd2/home/mdupont/2010/02/hiphop/hiphop-php-0.1/src/third_party/xhp/xhp -I/media/sdd2/home/mdupont/2010/02/hiphop/hiphop-php-0.1/src/third_party/libafdt/src -I/media/sdd2/home/mdupont/2010/02/hiphop/hiphop-php-0.1/src/third_party/libmbfl -I/media/sdd2/home/mdupont/2010/02/hiphop/hiphop-php-0.1/src/third_party/libmbfl/mbfl -I/media/sdd2/home/mdupont/2010/02/hiphop/hiphop-php-0.1/src/third_party/libmbfl/filter -I/media/sdd2/home/mdupont/2010/02/hiphop/hiphop-php-0.1/src -I/media/sdd2/home/mdupont/2010/02/hiphop/hiphop-php-0.1/src/lib/system/gen   -o CMakeFiles/hphp_runtime_static.dir/cpp/base/string_offset.cpp.o -c /media/sdd2/home/mdupont/2010/02/hiphop/hiphop-php-0.1/src/cpp/base/string_offset.cpp
In file included from /media/sdd2/home/mdupont/2010/02/hiphop/hiphop-php-0.1/src/cpp/base/zend/zend_string.h:22:0,
                 from /media/sdd2/home/mdupont/2010/02/hiphop/hiphop-php-0.1/src/cpp/base/type_string.h:24,
                 from /media/sdd2/home/mdupont/2010/02/hiphop/hiphop-php-0.1/src/cpp/base/string_offset.cpp:18:
/media/sdd2/home/mdupont/2010/02/hiphop/hiphop-php-0.1/src/cpp/base/type_variant.h:95:3: error: ‘HPHP::Variant::Variant(ssize_t)’ cannot be overloaded
/media/sdd2/home/mdupont/2010/02/hiphop/hiphop-php-0.1/src/cpp/base/type_variant.h:92:3: error: with ‘HPHP::Variant::Variant(int)’

Problem:
	int is the same as ssize_t

Fix :
    remove the definition.


bug #2

cd /media/sdd2/home/mdupont/2010/02/hiphop/hiphop-php-0.1/builddir/src && /media/NewFoundSpace/usr/local/bin/c++   -D_GNU_SOURCE -D_REENTRANT=1 -D_PTHREADS=1 -fPIC -fno-omit-frame-pointer -ftemplate-depth-60 -Wall -Woverloaded-virtual -Wno-deprecated -Wno-parentheses -Wno-strict-aliasing -Wno-write-strings  -I/usr/local/include -I/usr/include/mysql -I/usr/include/libxml2 -I/media/sdd2/home/mdupont/2010/02/hiphop/hiphop-php-0.1/src/third_party/libsqlite3 -I/media/sdd2/home/mdupont/2010/02/hiphop/hiphop-php-0.1/src/third_party/timelib -I/media/sdd2/home/mdupont/2010/02/hiphop/hiphop-php-0.1/src/third_party/xhp/xhp -I/media/sdd2/home/mdupont/2010/02/hiphop/hiphop-php-0.1/src/third_party/libafdt/src -I/media/sdd2/home/mdupont/2010/02/hiphop/hiphop-php-0.1/src/third_party/libmbfl -I/media/sdd2/home/mdupont/2010/02/hiphop/hiphop-php-0.1/src/third_party/libmbfl/mbfl -I/media/sdd2/home/mdupont/2010/02/hiphop/hiphop-php-0.1/src/third_party/libmbfl/filter -I/media/sdd2/home/mdupont/2010/02/hiphop/hiphop-php-0.1/src -I/media/sdd2/home/mdupont/2010/02/hiphop/hiphop-php-0.1/src/lib/system/gen   -o CMakeFiles/hphp_runtime_static.dir/cpp/base/program_functions.cpp.o -c /media/sdd2/home/mdupont/2010/02/hiphop/hiphop-php-0.1/src/cpp/base/program_functions.cpp
In file included from /media/sdd2/home/mdupont/2010/02/hiphop/hiphop-php-0.1/src/cpp/base/server/transport.h:23:0,
                 from /media/sdd2/home/mdupont/2010/02/hiphop/hiphop-php-0.1/src/cpp/base/execution_context.h:20,
                 from /media/sdd2/home/mdupont/2010/02/hiphop/hiphop-php-0.1/src/cpp/base/builtin_functions.h:20,
                 from /media/sdd2/home/mdupont/2010/02/hiphop/hiphop-php-0.1/src/cpp/base/program_functions.cpp:18:
/media/sdd2/home/mdupont/2010/02/hiphop/hiphop-php-0.1/src/cpp/base/type_array.h:314:11: error: ‘HPHP::Variant HPHP::Array::rvalAt(ssize_t, HPHP::int64) const’ cannot be overloaded
/media/sdd2/home/mdupont/2010/02/hiphop/hiphop-php-0.1/src/cpp/base/type_array.h:306:11: error: with ‘HPHP::Variant HPHP::Array::rvalAt(int, HPHP::int64) const’
/media/sdd2/home/mdupont/2010/02/hiphop/hiphop-php-0.1/src/cpp/base/type_array.h:337:17: error: ‘const HPHP::Variant HPHP::Array::operator[](ssize_t) const’ cannot be overloaded
/media/sdd2/home/mdupont/2010/02/hiphop/hiphop-php-0.1/src/cpp/base/type_array.h:335:17: error: with ‘const HPHP::Variant HPHP::Array::operator[](int) const’
In file included from /media/sdd2/home/mdupont/2010/02/hiphop/hiphop-php-0.1/src/cpp/base/program_functions.cpp:18:0:
/media/sdd2/home/mdupont/2010/02/hiphop/hiphop-php-0.1/src/cpp/base/builtin_functions.h: In function ‘ssize_t HPHP::id(ssize_t)’:
/media/sdd2/home/mdupont/2010/02/hiphop/hiphop-php-0.1/src/cpp/base/builtin_functions.h:569:16: error: redefinition of ‘ssize_t HPHP::id(ssize_t)’
/media/sdd2/home/mdupont/2010/02/hiphop/hiphop-php-0.1/src/cpp/base/builtin_functions.h:566:16: error: ‘int HPHP::id(int)’ previously defined here
make[3]: *** [src/CMakeFiles/hphp_runtime_static.dir/cpp/base/program_functions.cpp.o] Error 1

Solution : 
use the ifndef ssize_t_NOT_INT

Changed ssize_t to "long int"
I think we should make some definitions for ssize_t. 

 bug #3

p_runtime_static.dir/cpp/base/server/libevent_transport.cpp.o -c /media/sdd2/home/mdupont/2010/02/hiphop/hiphop-php-0.1/src/cpp/base/server/libevent_transport.cpp
/media/sdd2/home/mdupont/2010/02/hiphop/hiphop-php-0.1/src/cpp/base/server/libevent_transport.cpp: In constructor ‘HPHP::LibEventTransport::LibEventTransport(HPHP::LibEventServer*, evhttp_request*, int)’:
/media/sdd2/home/mdupont/2010/02/hiphop/hiphop-php-0.1/src/cpp/base/server/libevent_transport.cpp:69:34: error: ‘struct evhttp_request’ has no member named ‘ext_method’

bug #4 
cd /media/sdd2/home/mdupont/2010/02/hiphop/hiphop-php-0.1/builddir/src && /media/NewFoundSpace/usr/local/bin/c++   -D_GNU_SOURCE -D_REENTRANT=1 -D_PTHREADS=1 -fPIC -fno-omit-frame-pointer -ftemplate-depth-60 -Wall -Woverloaded-virtual -Wno-deprecated -Wno-parentheses -Wno-strict-aliasing -Wno-write-strings  -I/usr/local/include -I/usr/include/mysql -I/usr/include/libxml2 -I/media/sdd2/home/mdupont/2010/02/hiphop/hiphop-php-0.1/src/third_party/libsqlite3 -I/media/sdd2/home/mdupont/2010/02/hiphop/hiphop-php-0.1/src/third_party/timelib -I/media/sdd2/home/mdupont/2010/02/hiphop/hiphop-php-0.1/src/third_party/xhp/xhp -I/media/sdd2/home/mdupont/2010/02/hiphop/hiphop-php-0.1/src/third_party/libafdt/src -I/media/sdd2/home/mdupont/2010/02/hiphop/hiphop-php-0.1/src/third_party/libmbfl -I/media/sdd2/home/mdupont/2010/02/hiphop/hiphop-php-0.1/src/third_party/libmbfl/mbfl -I/media/sdd2/home/mdupont/2010/02/hiphop/hiphop-php-0.1/src/third_party/libmbfl/filter -I/media/sdd2/home/mdupont/2010/02/hiphop/hiphop-php-0.1/src -I/media/sdd2/home/mdupont/2010/02/hiphop/hiphop-php-0.1/src/lib/system/gen   -o CMakeFiles/hphp_runtime_static.dir/cpp/ext/ext_class.cpp.o -c /media/sdd2/home/mdupont/2010/02/hiphop/hiphop-php-0.1/src/cpp/ext/ext_class.cpp
/media/sdd2/home/mdupont/2010/02/hiphop/hiphop-php-0.1/src/cpp/ext/ext_class.cpp: In function ‘bool HPHP::f_class_exists(const HPHP::String&, bool)’:
/media/sdd2/home/mdupont/2010/02/hiphop/hiphop-php-0.1/src/cpp/ext/ext_class.cpp:44:9: error: ‘HPHP::ClassInfo::ClassInfo’ names the constructor, not the type
/media/sdd2/home/mdupont/2010/02/hiphop/hiphop-php-0.1/src/cpp/ext/ext_class.cpp:46:10: error: ‘info’ was not declared in this scope
/media/sdd2/home/mdupont/2010/02/hiphop/hiphop-php-0.1/src/cpp/ext/ext_class.cpp: In function ‘bool HPHP::f_interface_exists(const HPHP::String&, bool)’:
/media/sdd2/home/mdupont/2010/02/hiphop/hiphop-php-0.1/src/cpp/ext/ext_class.cpp:50:9: error: ‘HPHP::ClassInfo::ClassInfo’ names the constructor, not the type
/media/sdd2/home/mdupont/2010/02/hiphop/hiphop-php-0.1/src/cpp/ext/ext_class.cpp:52:10: error: ‘info’ was not declared in this scope
/media/sdd2/home/mdupont/2010/02/hiphop/hiphop-php-0.1/src/cpp/ext/ext_class.cpp:53:1: warning: control reaches end of non-void function
/media/sdd2/home/mdupont/2010/02/hiphop/hiphop-php-0.1/src/cpp/ext/ext_class.cpp: In function ‘bool HPHP::f_class_exists(const HPHP::String&, bool)’:
/media/sdd2/home/mdupont/2010/02/hiphop/hiphop-php-0.1/src/cpp/ext/ext_class.cpp:47:1: warning: control reaches end of non-void function
make[3]: *** [src/CMakeFiles/hphp_runtime_static.dir/cpp/ext/ext_class.cpp.o] Error 1

bug #5

[  6%] Building CXX object src/CMakeFiles/hphp_runtime_static.dir/cpp/ext/ext_mb.cpp.o
cd /media/sdd2/home/mdupont/2010/02/hiphop/hiphop-php-0.1/builddir/src && /media/NewFoundSpace/usr/local/bin/c++   -D_GNU_SOURCE -D_REENTRANT=1 -D_PTHREADS=1 -fPIC -fno-omit-frame-pointer -ftemplate-depth-60 -Wall -Woverloaded-virtual -Wno-deprecated -Wno-parentheses -Wno-strict-aliasing -Wno-write-strings  -I/usr/local/include -I/usr/include/mysql -I/usr/include/libxml2 -I/media/sdd2/home/mdupont/2010/02/hiphop/hiphop-php-0.1/src/third_party/libsqlite3 -I/media/sdd2/home/mdupont/2010/02/hiphop/hiphop-php-0.1/src/third_party/timelib -I/media/sdd2/home/mdupont/2010/02/hiphop/hiphop-php-0.1/src/third_party/xhp/xhp -I/media/sdd2/home/mdupont/2010/02/hiphop/hiphop-php-0.1/src/third_party/libafdt/src -I/media/sdd2/home/mdupont/2010/02/hiphop/hiphop-php-0.1/src/third_party/libmbfl -I/media/sdd2/home/mdupont/2010/02/hiphop/hiphop-php-0.1/src/third_party/libmbfl/mbfl -I/media/sdd2/home/mdupont/2010/02/hiphop/hiphop-php-0.1/src/third_party/libmbfl/filter -I/media/sdd2/home/mdupont/2010/02/hiphop/hiphop-php-0.1/src -I/media/sdd2/home/mdupont/2010/02/hiphop/hiphop-php-0.1/src/lib/system/gen   -o CMakeFiles/hphp_runtime_static.dir/cpp/ext/ext_mb.cpp.o -c /media/sdd2/home/mdupont/2010/02/hiphop/hiphop-php-0.1/src/cpp/ext/ext_mb.cpp
/media/sdd2/home/mdupont/2010/02/hiphop/hiphop-php-0.1/src/cpp/ext/ext_mb.cpp:28:31: fatal error: mbfl/mbfl_convert.h: No such file or directory
compilation terminated.

#6 
[  9%] Building CXX object src/CMakeFiles/hphp_runtime_static.dir/cpp/ext/ext_icu.cpp.o
cd /media/sdd2/home/mdupont/2010/02/hiphop/hiphop-php-0.1/builddir/src && /media/NewFoundSpace/usr/local/bin/c++   -D_GNU_SOURCE -D_REENTRANT=1 -D_PTHREADS=1 -fPIC -fno-omit-frame-pointer -ftemplate-depth-60 -Wall -Woverloaded-virtual -Wno-deprecated -Wno-parentheses -Wno-strict-aliasing -Wno-write-strings  -I/usr/local/include -I/usr/include/mysql -I/usr/include/libxml2 -I/media/sdd2/home/mdupont/2010/02/hiphop/hiphop-php-0.1/src/third_party/libsqlite3 -I/media/sdd2/home/mdupont/2010/02/hiphop/hiphop-php-0.1/src/third_party/timelib -I/media/sdd2/home/mdupont/2010/02/hiphop/hiphop-php-0.1/src/third_party/xhp/xhp -I/media/sdd2/home/mdupont/2010/02/hiphop/hiphop-php-0.1/src/third_party/libafdt/src -I/media/sdd2/home/mdupont/2010/02/hiphop/hiphop-php-0.1/src/third_party/libmbfl -I/media/sdd2/home/mdupont/2010/02/hiphop/hiphop-php-0.1/src/third_party/libmbfl/mbfl -I/media/sdd2/home/mdupont/2010/02/hiphop/hiphop-php-0.1/src/third_party/libmbfl/filter -I/media/sdd2/home/mdupont/2010/02/hiphop/hiphop-php-0.1/src -I/media/sdd2/home/mdupont/2010/02/hiphop/hiphop-php-0.1/src/lib/system/gen   -o CMakeFiles/hphp_runtime_static.dir/cpp/ext/ext_icu.cpp.o -c /media/sdd2/home/mdupont/2010/02/hiphop/hiphop-php-0.1/src/cpp/ext/ext_icu.cpp
/media/sdd2/home/mdupont/2010/02/hiphop/hiphop-php-0.1/src/cpp/ext/ext_icu.cpp: In function ‘HPHP::String HPHP::f_icu_transliterate(const HPHP::String&, bool)’:
/media/sdd2/home/mdupont/2010/02/hiphop/hiphop-php-0.1/src/cpp/ext/ext_icu.cpp:71:25: error: ‘fromUTF8’ is not a member of ‘icu_4_0::UnicodeString’
/media/sdd2/home/mdupont/2010/02/hiphop/hiphop-php-0.1/src/cpp/ext/ext_icu.cpp:81:3: error: ‘CheckedArrayByteSink’ was not declared in this scope
/media/sdd2/home/mdupont/2010/02/hiphop/hiphop-php-0.1/src/cpp/ext/ext_icu.cpp:81:24: error: expected ‘;’ before ‘bs’
/media/sdd2/home/mdupont/2010/02/hiphop/hiphop-php-0.1/src/cpp/ext/ext_icu.cpp:82:9: error: ‘class icu_4_0::UnicodeString’ has no member named ‘toUTF8’
/media/sdd2/home/mdupont/2010/02/hiphop/hiphop-php-0.1/src/cpp/ext/ext_icu.cpp:82:16: error: ‘bs’ was not declared in this scope
make[3]: *** [src/CMakeFiles/hphp_runtime_static.dir/cpp/ext/ext_icu.cpp.o] Error 1


#7 
Linking CXX executable hphp
cd /media/sdd2/home/mdupont/2010/02/hiphop/hiphop-php-0.1/builddir/src/hphp && /usr/bin/cmake -E cmake_link_script CMakeFiles/hphp.dir/link.txt --verbose=1
/media/NewFoundSpace/usr/local/bin/c++   -fPIC -fno-omit-frame-pointer -ftemplate-depth-60 -Wall -Woverloaded-virtual -Wno-deprecated -Wno-parentheses -Wno-strict-aliasing -Wno-write-strings   -Wl,-Bsymbolic-functions CMakeFiles/hphp.dir/externals.cpp.o CMakeFiles/hphp.dir/main.cpp.o  -o hphp -rdynamic -ldl ../../../bin/libhphp_analysis.a ../../../bin/libhphp_runtime.a -lboost_system-mt -lboost_program_options-mt -lboost_filesystem-mt -lmysqlclient -lpcre -licuuc -licui18n -lcurl -lcap -lbfd /usr/local/lib/libiberty.a -ldl -lpthread -ltbb -lssl -lcrypto -lz ../../../bin/libtimelib.a -lexpat -lrt -lcrypto -lresolv -lcrypt ../../../bin/libsqlite3.a ../../../bin/libxhp.a ../../../bin/libafdt.a -levent -lmbfl -lxml2 -lonig -lmcrypt -lgd 
CMakeFiles/hphp.dir/main.cpp.o: In function `prepareOptions(ProgramOptions&, int, char**)':
main.cpp:(.text+0x3c4): undefined reference to `boost::program_options::options_description::options_description(std::basic_string<char, std::char_traits<char>, std::allocator<char> > const&, unsigned int, unsigned int)'
CMakeFiles/hphp.dir/main.cpp.o: In function `std::basic_string<char, std::char_traits<char>, std::allocator<char> > const& boost::program_options::validators::get_single_string<char>(std::vector<std::basic_string<char, std::char_traits<char>, std::allocator<char> >, std::allocator<std::basic_string<char, std::char_traits<char>, std::allocator<char> > > > const&, bool)':
main.cpp:(.text._ZN5boost15program_options10validators17get_single_stringIcEERKSbIT_St11char_traitsIS3_ESaIS3_EERKSt6vectorIS7_SaIS7_EEb[std::basic_string<char, std::char_traits<char>, std::allocator<char> > const& boost::program_options::validators::get_single_string<char>(std::vector<std::basic_string<char, std::char_traits<char>, std::allocator<char> >, std::allocator<std::basic_string<char, std::char_traits<char>, std::allocator<char> > > > const&, bool)]+0x101): undefined reference to `boost::program_options::validation_error::validation_error(boost::program_options::validation_error::kind_t, std::basic_string<char, std::char_traits<char>, std::allocator<char> > const&, std::basic_string<char, std::char_traits<char>, std::allocator<char> > const&)'
main.cpp:(.text._ZN5boost15program_options10validators17get_single_stringIcEERKSbIT_St11char_traitsIS3_ESaIS3_EERKSt6vectorIS7_SaIS7_EEb[std::basic_string<char, std::char_traits<char>, std::allocator<char> > const& boost::program_options::validators::get_single_string<char>(std::vector<std::basic_string<char, std::char_traits<char>, std::allocator<char> >, std::allocator<std::basic_string<char, std::char_traits<char>, std::allocator<char> > > > const&, bool)]+0x1ab): undefined reference to `boost::program_options::validation_error::validation_error(boost::program_options::validation_error::kind_t, std::basic_string<char, std::char_traits<char>, std::allocator<char> > const&, std::basic_string<char, std::char_traits<char>, std::allocator<char> > const&)'
../../../bin/libhphp_runtime.a(program_functions.cpp.o): In function `HPHP::execute_program(int, char**)':
program_functions.cpp:(.text+0x1ef8): undefined reference to `boost::program_options::options_description::options_description(std::basic_string<char, std::char_traits<char>, std::allocator<char> > const&, unsigned int, unsigned int)'
collect2: ld returned 1 exit status
make[3]: *** [src/hphp/hphp] Error 1


now we just need to link boost
I am compiling locally :
cd
/media/sdd2/home/mdupont/2010/02/hiphop/hiphop-php-0.1/builddir/src/hphp
/media/NewFoundSpace/usr/local/bin/c++   -fPIC -fno-omit-frame-pointer -ftemplate-depth-60 -Wall -Woverloaded-virtual -Wno-deprecated -Wno-parentheses -Wno-strict-aliasing -Wno-write-strings   -Wl,-Bsymbolic-functions CMakeFiles/hphp.dir/externals.cpp.o CMakeFiles/hphp.dir/main.cpp.o  -o hphp -rdynamic -ldl ../../../bin/libhphp_analysis.a ../../../bin/libhphp_runtime.a -L/usr/local/lib -lboost_system -lboost_program_options -lboost_filesystem -lmysqlclient -lpcre -licuuc -licui18n -lcurl -lcap -lbfd /usr/local/lib/libiberty.a -ldl -lpthread -ltbb -lssl -lcrypto -lz ../../../bin/libtimelib.a -lexpat -lrt -lcrypto -lresolv -lcrypt ../../../bin/libsqlite3.a ../../../bin/libxhp.a ../../../bin/libafdt.a -levent -lmbfl -lxml2 -lonig -lmcrypt -lgd

bug #8

Building hphpi
cd /media/sdd2/home/mdupont/2010/02/hiphop/hiphop-php-0.1/src/hphpi && /media/sdd2/home/mdupont/2010/02/hiphop/hiphop-php-0.1/builddir/src/hphp/hphp -t cpp -f exe --input-dir . -i hphpi.php -o gen --config hphpi_build.hdf --log=1
Exception: ParseError: [<string>:1] Unable to parse line hphpi_build.hdf
make[3]: *** [src/hphp/hphp] Error 255
make[3]: Leaving directory `/media/sdd2/home/mdupont/2010/02/hiphop/hiphop-php-0.1/builddir'
make[2]: *** [src/hphp/CMakeFiles/hphp.dir/all] Error 2
make[2]: Leaving directory `/media/sdd2/home/mdupont/2010/02/hiphop/hiphop-php-0.1/builddir'
make[1]: *** [all] Error 2
make[1]: Leaving directory `/media/sdd2/home/mdupont/2010/02/hiphop/hiphop-php-0.1/builddir'
make: *** [install-arch] Error 2
dpkg-buildpackage: error: fakeroot debian/rules binary gave error exit status 2
